(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a3038bb4"],{"2c75":function(t,e,a){"use strict";a("bcd0")},"59bc":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"content-info"},[t._m(0),e("div",{staticClass:"plan-info-list"},[e("div",{staticClass:"info-txt clear"},[e("p",[e("span",{staticClass:"label"},[t._v("dpmsID：")]),t._v(" "+t._s(t.productInfo.productId)+" ")]),e("p",[e("span",{staticClass:"label"},[t._v("产品名称：")]),t._v(" "+t._s(t.productInfo.productName)+" ")]),e("p",[e("span",{staticClass:"label"},[t._v("发布计划关键字：")]),t._v(" "+t._s(t.productInfo.releasePlanNameKw)+" ")])])])]),e("div",{staticClass:"content-info case-list",attrs:{loading:t.isLoading}},[t._m(1),e("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{size:"medium",inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"关键字",prop:"keyword"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入执行人"},model:{value:t.searchForm.keyword,callback:function(e){t.$set(t.searchForm,"keyword",e)},expression:"searchForm.keyword"}})],1),e("el-form-item",[e("el-button",{attrs:{icon:"el-icon-search",type:"primary"},on:{click:t.search}},[t._v("搜索")]),e("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.resetSearchForm}},[t._v("重置")]),e("el-button",{staticClass:"pri-add-btn",attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(e){return t.onOperate("new")}}},[t._v(" 新增默认py计划 ")])],1)],1),e("div",{staticClass:"content-table"},[e("el-table",{staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"rgba(144, 147, 153, 0.06)",color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},data:t.tableData}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"100px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"stage",label:"测试阶段",width:"80px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"planAliasName",label:"计划别名",width:"150px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"gitRepository",label:"git仓库地址",width:"300px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"gitBranch",label:"git分支",width:"200px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"jenkinsNode",label:"运行节点",width:"200px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"runCmd",label:"执行命令",width:"200px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"crontabSwitch",label:"定时任务开关",width:"120px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"crontabExpression",label:"定时任务表达式",width:"150px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"emailSwitch",label:"通知开关",width:"100px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"emailSendto",label:"通知人列表",width:"150px",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"操作",width:"400px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("el-button",{attrs:{type:"info",size:"mini",plain:""},on:{click:function(e){return t.onOperate("edit",a.row.id)}}},[t._v("编辑")]),e("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(e){return t.onDel("删除",a.row)}}},[t._v("删除")])],1)]}}])})],1)],1),e("div",{staticClass:"content-footer clear"},[e("div",{staticClass:"block page-list self-right"},[e("vue-pagination",{attrs:{currentPage:t.searchForm.page,pageSize:t.searchForm.perPage,totalNum:t.total},on:{sizeChange:t.pageSizeChange,currentPageChange:t.pageChange}})],1)])],1),e("ShowAddPlanConfigDialog",{attrs:{dialogFormVisible:t.dialogFormVisible,dialogTitle:t.dialogTitle,id:t.configId},on:{"update:dialogFormVisible":function(e){t.dialogFormVisible=e},"update:dialog-form-visible":function(e){t.dialogFormVisible=e},success:t.resetForm}})],1)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-header"},[e("div",{staticClass:"info-name"},[t._v("产品信息")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-header clear"},[e("div",{staticClass:"info-name self-left"},[t._v(" 版本默认py计划 ")])])}],n=(a("14d9"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-wrap"},[e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.visible,width:"600px","close-on-click-modal":!1},on:{close:t.onResetForm}},[e("el-form",{ref:"planConfigFormRef",staticClass:"form-common",attrs:{model:t.planConfigForm,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"测试阶段",prop:"stage"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.planConfigForm.stage,callback:function(e){t.$set(t.planConfigForm,"stage",e)},expression:"planConfigForm.stage"}},t._l(t.stageOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"计划别名",prop:"name"}},[e("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入计划别名"},model:{value:t.planConfigForm.planAliasName,callback:function(e){t.$set(t.planConfigForm,"planAliasName",e)},expression:"planConfigForm.planAliasName"}})],1),e("el-form-item",{attrs:{label:"Git仓库",prop:"gitRepository"}},[e("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入代码仓库地址"},model:{value:t.planConfigForm.gitRepository,callback:function(e){t.$set(t.planConfigForm,"gitRepository",e)},expression:"planConfigForm.gitRepository"}})],1),e("el-form-item",{attrs:{label:"Git分支",prop:"gitBranch"}},[e("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入代码拉取分支"},model:{value:t.planConfigForm.gitBranch,callback:function(e){t.$set(t.planConfigForm,"gitBranch",e)},expression:"planConfigForm.gitBranch"}})],1),e("el-form-item",{attrs:{label:"运行节点",prop:"jenkinsNode"}},[e("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入jenkins节点"},model:{value:t.planConfigForm.jenkinsNode,callback:function(e){t.$set(t.planConfigForm,"jenkinsNode",e)},expression:"planConfigForm.jenkinsNode"}})],1),e("el-form-item",{staticClass:"custom-size",attrs:{prop:"runCmd",label:"执行命令"}},[e("el-input",{attrs:{placeholder:"请输入执行命令"},model:{value:t.planConfigForm.runCmd,callback:function(e){t.$set(t.planConfigForm,"runCmd",e)},expression:"planConfigForm.runCmd"}})],1),e("el-form-item",{staticClass:"custom-size",attrs:{prop:"crontabSwitch",label:"定时任务开关"}},[e("el-switch",{attrs:{"active-text":t.planConfigForm.crontabSwitch,"active-value":"已开启","active-color":"rgb(22,140,0)","inactive-value":"已关闭","inactive-color":"rgb(200,0,0)"},on:{change:function(e){return t.changeScheduleSwitch()}},model:{value:t.planConfigForm.crontabSwitch,callback:function(e){t.$set(t.planConfigForm,"crontabSwitch",e)},expression:"planConfigForm.crontabSwitch"}})],1),"已开启"===t.planConfigForm.crontabSwitch?e("el-form-item",{staticClass:"custom-size",attrs:{prop:"crontabExpression",label:"计划时间"}},[e("el-input",{attrs:{placeholder:"请输入crontab表达式"},model:{value:t.planConfigForm.crontabExpression,callback:function(e){t.$set(t.planConfigForm,"crontabExpression",e)},expression:"planConfigForm.crontabExpression"}},[e("el-popover",{attrs:{slot:"suffix",placement:"right",width:"450",trigger:"hover"},slot:"suffix"},[e("div",[e("pre",[e("b",[t._v("crontab表达式，共5位，最小粒度为分钟")]),t._v("\n*    *    *    *    *\n-    -    -    -    -\n|    |    |    |    |\n|    |    |    |    +----- 星期中星期几 (0 - 6) (星期天 为0)\n|    |    |    +---------- 月份 (1 - 12)\n|    |    +--------------- 一个月中的第几天 (1 - 31)\n|    +-------------------- 小时 (0 - 23)\n+------------------------- 分钟 (0 - 59)\n【每分钟】\n* * * * *\n【每小时的第一分】\n1 * * * *\n【每天7:50】\n50 7 * * *\n【每两个小时】\n0 */2 * * *\n【每月1号和15号】\n0 0 1,15 * *\n【每周一至周五3点钟】\n  00 03 * * 1-5\n【每月的1、11、21、31日的6:30】\n30 6 */10 * *\n【每月每天的午夜0点20分, 2点20分, 4点20分】\n20 0-23/2 * * *\n【在12月内, 每天的早上6点到12点，每隔3个小时0分钟】\n0 6-12/3 * 12 *\n             ")])]),e("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1)],1):t._e(),e("el-form-item",{staticClass:"custom-size",attrs:{prop:"emailSwitch",label:"通知开关"}},[e("el-switch",{attrs:{"active-text":t.planConfigForm.emailSwitch,"active-value":"已开启","active-color":"rgb(22,140,0)","inactive-value":"已关闭","inactive-color":"rgb(200,0,0)"},on:{change:function(e){return t.changeScheduleSwitch()}},model:{value:t.planConfigForm.emailSwitch,callback:function(e){t.$set(t.planConfigForm,"emailSwitch",e)},expression:"planConfigForm.emailSwitch"}})],1),e("el-form-item",{attrs:{label:"通知人列表",prop:"testUsers"}},[e("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入通知人企业微信，逗号隔开"},model:{value:t.planConfigForm.emailSendto,callback:function(e){t.$set(t.planConfigForm,"emailSendto",e)},expression:"planConfigForm.emailSendto"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.onResetForm}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",loading:t.isLoading},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)}),l=[],r=a("37b6"),s={name:"AddPlanConfig",props:{dialogTitle:{type:String,default:"新增"},dialogFormVisible:{type:Boolean,default:!1},id:{default:""}},computed:{visible(){return this.dialogFormVisible}},watch:{dialogFormVisible(t){t&&this.id&&this.getDetail()}},data(){return{isLoading:!1,planConfigForm:{productId:"",releasePlanNameKw:"",productName:"",stage:"",planAliasName:"",gitRepository:"",gitBranch:"",jenkinsNode:"",runCmd:"",crontabSwitch:"已关闭",crontabExpression:"",emailSwitch:"已关闭",emailSendto:""},stageOptions:[{value:"冒烟测试",label:"冒烟测试"},{value:"SIT测试",label:"SIT测试"},{value:"回归测试",label:"回归测试"},{value:"灰度测试",label:"灰度测试"},{value:"其他测试",label:"其他测试"}],rules:{productId:[{required:!0,message:"产品id不能为空",trigger:"blur"}],productName:[{required:!0,message:"产品名称不能为空",trigger:"blur"}],stage:[{required:!0,message:"测试阶段不能为空",trigger:"blur"}],planAliasName:[{required:!0,message:"计划别名不能为空",trigger:"blur"}],gitRepository:[{required:!0,message:"git仓库地址不能为空",trigger:"blur"},{validator:r["d"],trigger:"blur"}],jenkinsNode:[{required:!0,message:"jenkin运行节点不能为空",trigger:"blur"}],gitBranch:[{required:!0,message:"git分支不能为空",trigger:"blur"}],runCmd:[{required:!0,message:"执行命令不能为空",trigger:"blur"}]}}},methods:{changeScheduleSwitch(){},getDetail(){this.$http.get("/hirunner/planConfigList/"+this.id).then(({data:t})=>{this.planConfigForm.productId=t.productId,this.planConfigForm.productName=t.productName,this.planConfigForm.releasePlanNameKw=t.releasePlanNameKw,this.planConfigForm.stage=t.stage,this.planConfigForm.planAliasName=t.planAliasName,this.planConfigForm.gitRepository=t.gitRepository,this.planConfigForm.gitBranch=t.gitBranch,this.planConfigForm.jenkinsNode=t.jenkinsNode,this.planConfigForm.runCmd=t.runCmd,this.planConfigForm.crontabSwitch=t.crontabSwitch,this.planConfigForm.crontabExpression=t.crontabExpression,this.planConfigForm.emailSwitch=t.emailSwitch,this.planConfigForm.emailSendto=t.emailSendto})},onResetForm(){this.$refs.planConfigFormRef.resetFields(),this.isLoading=!1,this.planConfigForm.productId="",this.planConfigForm.productName="",this.planConfigForm.releasePlanNameKw="",this.planConfigForm.planAliasName="",this.planConfigForm.gitRepository="",this.planConfigForm.gitBranch="",this.planConfigForm.jenkinsNode="",this.planConfigForm.runCmd="",this.planConfigForm.crontabExpression="",this.planConfigForm.emailSendto="",this.$emit("update:dialogFormVisible",!1)},onSubmit(){this.$refs.planConfigFormRef.validate(t=>{if(t){let t=localStorage.getItem("productInfo");t=JSON.parse(t),this.planConfigForm.productId=t.productId,this.planConfigForm.releasePlanNameKw=t.releasePlanNameKw,this.planConfigForm.productName=t.name,this.planConfigForm.planAliasName=this.planConfigForm.planAliasName.trim(),this.planConfigForm.gitRepository=this.planConfigForm.gitRepository.trim(),this.planConfigForm.gitBranch=this.planConfigForm.gitBranch.trim(),this.planConfigForm.jenkinsNode=this.planConfigForm.jenkinsNode.trim(),this.planConfigForm.runCmd=this.planConfigForm.runCmd.trim(),this.planConfigForm.crontabExpression=this.planConfigForm.crontabExpression.trim(),this.planConfigForm.emailSendto=this.planConfigForm.emailSendto.trim(),this.isLoading=!0,this.onRequest()}})},onRequest(){const{productId:t,releasePlanNameKw:e,productName:a,stage:i,planAliasName:o,gitRepository:n,gitBranch:l,runCmd:r,crontabSwitch:s,crontabExpression:c,emailSwitch:p,emailSendto:m,jenkinsNode:g}=this.planConfigForm;let d={productId:t,releasePlanNameKw:e,productName:a,stage:i,planAliasName:o,gitRepository:n,gitBranch:l,jenkinsNode:g,runCmd:r,crontabSwitch:s,crontabExpression:c,emailSwitch:p,emailSendto:m},h="post",u="/hirunner/planConfigList";this.id&&(h="put",u="/hirunner/planConfigList/"+this.id),this.$http[h](u,d).then(()=>{this.$notifyMessage("计划配置保存成功",{type:"success"}),this.onResetForm(),this.$emit("success")}).finally(()=>{this.isLoading=!1})}}},c=s,p=(a("f278"),a("2877")),m=Object(p["a"])(c,n,l,!1,null,"31a5f695",null),g=m.exports,d=a("925a"),h={components:{ShowAddPlanConfigDialog:g},data(){return{isLoading:!1,dialogTitle:"查看命令输出",dialogFormVisible:!1,configId:"",searchForm:{page:1,perPage:10,keyword:""},tableData:[],currentPage:1,productInfo:null,total:0}},created(){let t=localStorage.getItem("productInfo");t=JSON.parse(t)||{},this.productInfo={productId:t.productId,productName:t.name,releasePlanNameKw:t.releasePlanNameKw},this.getTableData()},methods:{async getTableData(){let t=`/hirunner/products/${this.productInfo.productId}/planConfigList`,e=[],a=Object.keys(this.searchForm);a.forEach(t=>{let a=this.searchForm[t];a&&e.push(`${t}=${this.searchForm[t]}`)}),e.push("releasePlanNameKw="+this.productInfo.releasePlanNameKw),t=t+"?"+e.join("&"),this.isLoading=!0;try{let{data:e}=await this.$http.get(t);this.tableData=e.items||[],this.total=e.totalNum||0,this.isLoading=!1}catch(i){this.isLoading=!1}},resetForm(){this.$refs.searchForm.resetFields(),this.getTableData()},search(){this.searchForm.page=1,this.getTableData()},onOperate(t,e=""){const a={new:"新增计划配置",edit:"编辑计划配置"};this.dialogTitle=a[t],this.dialogFormVisible=!0,this.configId=e},onDel(t,e){Object(d["a"])(`是否${t}此默认计划配置？`,()=>{this.operateRow(t,e)},{confirmButtonText:t})},operateRow(t,{id:e}){let a,i,o={};"删除"===t&&(a="/hirunner/planConfigList/"+e,i="delete"),this.$http[i](a,o).then(()=>{this.$notifyMessage(t+"成功",{type:"success"}),this.getTableData()})},pageSizeChange(t){this.searchForm.perPage=t,this.searchForm.page=1,this.getTableData()},pageChange(t){this.searchForm.page=t,this.getTableData()},resetSearchForm(){this.searchForm.keyword="",this.getTableData()}}},u=h,f=(a("2c75"),Object(p["a"])(u,i,o,!1,null,"4dc07832",null));e["default"]=f.exports},"8a30":function(t,e,a){},bcd0:function(t,e,a){},f278:function(t,e,a){"use strict";a("8a30")}}]);
//# sourceMappingURL=chunk-a3038bb4.46898ee5.js.map